<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="devis_template" model="ir.actions.report">
        <field name="name">OD QUOTE</field>
        <field name="model">sale.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">product_website_addons.print_devis_template</field>
        <field name="report_file">product_website_addons.print_devis_template</field>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="binding_type">report</field>
        <field name="print_report_name">'OD Devis - %s' % (object.name)</field>
    </record>


    <template id="print_devis_template_document">
        <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>
        <main style="font-size: 18px;">
            <t t-set="company" t-value="o.company_id"/>
            <div class="page" style="padding: 0px; margin: 0;">
                <div style="background-color: #dfecf5; color: black; text-align: center; padding: 5px; font-size: 16px; font-weight: bold;">
                    QUOTE
                </div>

                <table style="width: 100%; border-collapse: collapse; margin-top: 5px; border: 1px solid white;">
                    <tr>
                        <td style="width: 57%; font-size: 14px; border: 1px solid white;">
                            <strong t-translate="yes">Contact :</strong>
                            <t t-esc="o.partner_id.name or ''"/>
                            <br/>
                            <strong t-translate="yes">Email</strong>
                            <t t-esc="o.partner_id.email or ''"/>
                            <br/>
                            <strong t-translate="yes">Quote No. :</strong>
                            <t t-esc="o.name or ''"/>
                            <br/>
                            <strong t-translate="yes">Customer Contact:</strong>
                            <t t-esc="o.partner_id.phone or ''"/>
                            <br/>
                            <strong t-translate="yes">Date :</strong>
                            <t t-esc="o.date_order.strftime('%d/%m/%Y') if o.date_order else ''"/>
                        </td>


                        <td style="width: 43%; font-size: 14px; border: 1px solid white;">
                            <strong t-translate="yes">Company :</strong>
                            <t t-esc="o.company_id.name or ''"/>
                            <br/>
                            <strong t-translate="yes">Address :</strong>
                            <t t-esc="o.company_id.street or ''"/>,
                            <t t-esc="o.company_id.city or ''"/>
                            -
                            <t t-esc="o.company_id.zip or ''"/>
                            <br/>
                            <strong t-translate="yes">Country :</strong>
                            <t t-esc="o.company_id.country_id.name or ''"/>
                            <br/>
                            <strong t-translate="yes">Email :</strong>
                            <t t-esc="o.company_id.email or ''"/>
                            <br/>
                            <strong t-translate="yes">Phone :</strong>
                            <t t-esc="o.company_id.phone or ''"/>
                        </td>
                    </tr>
                </table>

                <table style="width: 100%; border-collapse: collapse; margin-top: 5px; border: 1px solid white;">
                    <thead>
                        <tr style="background-color: #dfecf5; font-size: 16px;">
                            <th style="border: 1px solid white; padding: 3px; font-weight: bold;">Ref.</th>
                            <th style="border: 1px solid white; padding: 3px; font-weight: bold;">Description</th>
                            <th style="border: 1px solid white; padding: 3px; font-weight: bold;">Qty</th>
                            <th style="border: 1px solid white; padding: 3px; font-weight: bold;">Unit Price</th>
                            <th style="border: 1px solid white; padding: 3px; font-weight: bold;">Total HT â‚¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="o.order_line" t-as="line">
                            <tr style="font-size: 14px;">
                                <td style="border: 1px solid white; padding: 3px;">
                                    <strong t-translate="yes">Product</strong>
                                    <br/>
                                    <strong t-translate="yes">Reference</strong>
                                    <br/>
                                </td>
                                <td style="border: 1px solid white; padding: 3px;">
                                    <t t-esc="line.product_id.name or ''"/>
                                    <br/>
                                    <t t-esc="line.product_id.default_code or ''"/>
                                    <br/>
                                    <t t-foreach="line.product_id.product_template_attribute_value_ids"
                                       t-as="attribute_value">
                                        <span>
                                            <strong><t t-esc="attribute_value.attribute_id.name"/>:
                                            </strong>
                                            <t t-esc="attribute_value.name"/>
                                        </span>
                                        <br/>
                                    </t>
                                    <t t-if="line.product_id.image_128">
                                        <img t-att-src="image_data_uri(line.product_id.image_128)"
                                             style="max-width: 80px; max-height: 80px; float: left; display: inline-block; margin-right: 10px;"
                                             alt="Product Image"/>
                                    </t>
                                    <t t-else="">
                                        <span>No Image Available</span>
                                    </t>

                                </td>
                                <td style="border: 1px solid white; padding: 3px; text-align: center;">
                                    <t t-esc="int(line.product_uom_qty) if line.product_uom_qty else ''"/>
                                </td>

                                <td style="border: 1px solid white; padding: 3px; text-align: center;">
                                    <t t-esc="'%.2f' % line.price_unit"/>


                                </td>
                                <td style="border: 1px solid white; padding: 3px; text-align: center;">
                                    <t t-esc="'%.2f' % line.price_subtotal"/>
                                </td>

                            </tr>
                        </t>
                    </tbody>
                </table>

                <div style="background-color: #dfecf5; color: black; text-align: center; padding: 5px; font-size: 16px; font-weight: bold;">
                    INFORMATION
                </div>

                <div>
                    <span t-field="o.note"
                          t-attf-style="#{'text-align:justify;text-justify:inter-word;font-size:16px;' if o.company_id.terms_type != 'html' else 'font-size:16px;'}"
                          name="order_note"/>
                    <p t-if="not is_html_empty(o.payment_term_id.note)">
                        <span t-field="o.payment_term_id.note">The payment should also be transmitted with love</span>
                    </p>
                    <div class="oe_structure"/>
                    <p t-if="o.fiscal_position_id and not is_html_empty(o.fiscal_position_id.sudo().note)"
                       id="fiscal_position_remark">
                        <strong>Fiscal Position Remark:</strong>
                        <span t-field="o.fiscal_position_id.sudo().note">No further requirements for this payment
                        </span>
                    </p>
                </div>

                <div class="oe_structure"></div>

                <div t-if="not o.signature" class="oe_structure"></div>
                <div t-else="" class="mt-4 ml64 mr4" name="signature">
                    <div class="offset-8">
                        <strong>Signature</strong>
                    </div>
                    <div class="offset-8">
                        <img t-att-src="image_data_uri(o.signature)" style="max-height: 4cm; max-width: 8cm;"/>
                    </div>
                    <div class="offset-8 text-center">
                        <span t-field="o.signed_by">Oscar Morgan</span>
                    </div>
                </div>
            </div>
        </main>
        <t t-call="product_website_addons.exemple_footer"/>
    </template>

    <template id="exemple_footer">
        <t t-extend="web.external_layout_footer">
            <t t-jquery="div.footer" t-operation="replace">
                <div class="footer" style="width: 100%; font-size: 12px;">
                    <table style="width: 100%; border-collapse: collapse; border: 1px solid white;">
                        <tr>
                            <td style="text-align: left; vertical-align: middle; padding-left: 10px; width: 70%;">
                                <t t-raw="o.sale_order_template_id.pied_page"/>
                            </td>
                            <td style="text-align: right; vertical-align: middle; padding-right: 10px; width: 30%;">
                                <img t-att-src="'/product_website_addons/static/src/img/logo_footer.png'"
                                     style="max-height: 50px; width: auto;"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </t>
        </t>
    </template>

    <template id="print_devis_template">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="o">
                <t t-call="product_website_addons.print_devis_template_document" t-lang="o.partner_id.lang or 'fr_FR'"/>
            </t>
        </t>
    </template>

    <template id="sale_order_portal_sidebar_custom" inherit_id="sale.sale_order_portal_template">

        <xpath expr="//a[@id='print_invoice_report']" position="attributes">
            <attribute name="t-att-href">"/report/pdf/product_website_addons.print_devis_template/" +
                str(sale_order.id)
            </attribute>
        </xpath>

    </template>

    <template id="sale_order_portal_content_inherit" inherit_id="sale.sale_order_portal_content">
        <xpath expr="//section[@id='terms']/em" position="replace">
            <em>
                <t t-esc="sale_order.with_context(lang=request.env.context.get('lang')).note or ''"/>
            </em>
        </xpath>
    </template>

</odoo>